<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benchmarking disk.frame 1: disk.frame beats Dask! disk.frame beats JuliaDB! anyone else wanna challenge? • disk.frame</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking disk.frame 1: disk.frame beats Dask! disk.frame beats JuliaDB! anyone else wanna challenge?">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">disk.frame</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/concepts.html">Concepts for disk.frame</a>
    </li>
    <li>
      <a href="../articles/data-table-syntax.html">Using data.table syntax with disk.frame</a>
    </li>
    <li>
      <a href="../articles/ingesting-data.html">Ingesting Data</a>
    </li>
    <li>
      <a href="../articles/intro-disk-frame.html">Quick Start</a>
    </li>
    <li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/vs-dask-juliadb.html">Benchmarking disk.frame 1: disk.frame beats Dask! disk.frame beats JuliaDB! anyone else wanna challenge?</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Benchmarking disk.frame 1: disk.frame beats Dask! disk.frame beats JuliaDB! anyone else wanna challenge?</h1>
            
      
      
      <div class="hidden name"><code>vs-dask-juliadb.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level2">
<h2 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h2>
<p>This is the first in a series to benchmark the performance of disk.frame vs other medium-data tools. For Python, we will benchmkark Dask, and for Julia, we will benchmark JuliaDB.jl. In the process, I will do a warts-and-all account of the tools I have tested.</p>
</div>
<div id="tldr" class="section level1">
<h1 class="hasAnchor">
<a href="#tldr" class="anchor"></a>TL;DR</h1>
<p>For this simple benchmark, disk.frame is faster. But Dask has a more convenient syntax. JuliaDB.jl is not ready for prime time.</p>
<div id="timings" class="section level4">
<h4 class="hasAnchor">
<a href="#timings" class="anchor"></a>Timings</h4>
<p>Please note I have not tried to record the precise times over many runs, but I aim illustrate the magnitude of speed of the different packages</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">df =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="dt">tool =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"disk.frame"</span>, <span class="st">"Dask"</span>, <span class="st">"JuliaDB.jl"</span>),</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="dt">timing =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">22</span>, <span class="dv">50</span>, <span class="dv">76</span>)</a>
<a class="sourceLine" id="cb1-4" title="4">)</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">ggplot</span>(df) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> tool, <span class="dt">weight =</span> timing), <span class="dt">stat =</span> <span class="st">"count"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">"seconds"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Convert to desired format timing"</span>)</a></code></pre></div>
<p><img src="vs-dask-juliadb_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Next up is timings for the simple aggregation</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">df =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">tool =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"disk.frame"</span>, <span class="st">"Dask"</span>, <span class="st">"JuliaDB.jl"</span>),</a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="dt">timing =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>, <span class="fl">1.2</span>, <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb2-4" title="4">)</a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw">ggplot</span>(df) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> tool, <span class="dt">weight =</span> timing), <span class="dt">stat =</span> <span class="st">"count"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">"seconds"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Count(*) gorup-by timings"</span>)</a></code></pre></div>
<p><img src="vs-dask-juliadb_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>The data can be obtained from <a href="https://docs.rapids.ai/datasets/mortgage-data">Rapids.ai’s Fannie Mae Data distribution page</a>. I have downloaded the <a href="http://rapidsai-data.s3-website.us-east-2.amazonaws.com/notebook-mortgage-data/mortgage_2000-2016.tgz">17 Years data</a> which contains dat on 37 million loans with over 1.89 billions rows in Performance datasets.</p>
<p>To download and the data, here are some examples</p>
<p>For <em>Linux</em> users</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="fu">wget</span> http://rapidsai-data.s3-website.us-east-2.amazonaws.com/notebook-mortgage-data/mortgage_2000-2016.tgz</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="fu">tar</span> xzvg mortgage_2000-2016.tgz</a></code></pre></div>
<p>For <em>Mac</em> users</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">curl</span> http://rapidsai-data.s3-website.us-east-2.amazonaws.com/notebook-mortgage-data/mortgage_2000-2016.tgz -o mortgage_2000-2016.tgz</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="fu">tar</span> xzvg mortgage_2000-2016.tgz</a></code></pre></div>
<p>For <em>Windows</em> users, just download the file and extract the tgz file.</p>
</div>
<div id="benchmark-exercise-converting-csv-to-desired-format-and-simple-aggregation" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmark-exercise-converting-csv-to-desired-format-and-simple-aggregation" class="anchor"></a>Benchmark exercise: converting CSV to desired format and simple aggregation</h2>
<p>We find the largest possible single file to give each of the tool a test run.</p>
<div id="disk-frame" class="section level4">
<h4 class="hasAnchor">
<a href="#disk-frame" class="anchor"></a>disk.frame</h4>
<p>First up is disk.frame</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(disk.frame)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt; Loading required package: dplyr</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt; Loading required package: purrr</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; ## Message from disk.frame:</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; We have 1 workers to use with disk.frame.</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; To change that use setup_disk.frame(workers = n) or just setup_disk.frame() to use the defaults.</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-18" title="18"><span class="co">#&gt; It is recommend that you run the following immediately to setup disk.frame with multiple workers in order to parallelize your operations:</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">#&gt; ```r</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">#&gt; # this willl set disk.frame with multiple workers</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="co">#&gt; setup_disk.frame()</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="co">#&gt; # this will allow unlimited amount of data to be passed from worker to worker</span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="co">#&gt; options(future.globals.maxSize = Inf)</span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co">#&gt; ```</span></a>
<a class="sourceLine" id="cb5-27" title="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-28" title="28"><span class="co">#&gt; Attaching package: 'disk.frame'</span></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">#&gt; The following objects are masked from 'package:purrr':</span></a>
<a class="sourceLine" id="cb5-30" title="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-31" title="31"><span class="co">#&gt;     imap, imap_dfr, map, map_dfr, map2</span></a>
<a class="sourceLine" id="cb5-32" title="32"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb5-33" title="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-34" title="34"><span class="co">#&gt;     colnames, ncol, nrow</span></a>
<a class="sourceLine" id="cb5-35" title="35"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(<span class="kw"><a href="../reference/setup_disk.frame.html">setup_disk.frame</a></span>()) <span class="co"># ~4s</span></a>
<a class="sourceLine" id="cb5-36" title="36"><span class="co">#&gt; The number of workers available for disk.frame is 6</span></a>
<a class="sourceLine" id="cb5-37" title="37"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb5-38" title="38"><span class="co">#&gt;    0.00    0.03    3.56</span></a></code></pre></div>
<p>We note that there is some time needed for disk.frame to start up all the workers. Next we try to convert the largest CSV file to disk.frame format. The file to be converted is about 2.8GB in size</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">time_to_convert_disk.frame =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(df1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/csv_to_disk.frame.html">csv_to_disk.frame</a></span>(<span class="st">"c:/data/perf/Performance_2004Q3.txt"</span>, <span class="dt">header =</span> <span class="ot">FALSE</span>))[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3">time_to_convert_disk.frame</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; elapsed </span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt;   23.73</span></a></code></pre></div>
<p>Now that we have converted it, we want to a count by the first column. To achieve this we use a “two-stage” aggregation strategy. Note that use <code>keep="V1"</code> to bring only the column <code>V1</code> into RAM. This avoids the reading of other unnecessary columns and should speed-up the analysis significantly</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">time_to_agg_disk.frame =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(summ &lt;-<span class="st"> </span>df1[,.N, V1, <span class="dt">keep =</span> <span class="st">"V1"</span>][, .(<span class="dt">N =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(N)), V1])</a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3">time_to_agg_disk.frame</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt;    0.08    0.04    3.33</span></a></code></pre></div>
<p>We can inspect the result as well.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">summ</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&gt;                    V1   N</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">#&gt;      1: 4.940729e-313 111</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">#&gt;      2: 4.940893e-313  95</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#&gt;      3: 4.941078e-313 133</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#&gt;      4: 4.941381e-313 115</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#&gt;      5: 4.941720e-313  75</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">#&gt;     ---                  </span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">#&gt; 389486: 4.940567e-312  17</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt; 389487: 4.940569e-312 104</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt; 389488: 4.940592e-312  97</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">#&gt; 389489: 4.940607e-312 162</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">#&gt; 389490: 4.940627e-312  15</span></a></code></pre></div>
<p>Another way to perform the analysis is to use <code>dplyr</code> syntax to perform a two-stage “group-by” which is:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">df1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="st">  </span><span class="kw"><a href="../reference/srckeep.html">srckeep</a></span>(<span class="st">"V1"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(V1) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">N =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="st">  </span>collect <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(V1) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">N =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(N)) <span class="op">%&gt;%</span><span class="st"> </span></a></code></pre></div>
<p>However, the <code>dplyr</code> syntax tends to be slightly slower than using data.table syntax.</p>
</div>
<div id="dask" class="section level4">
<h4 class="hasAnchor">
<a href="#dask" class="anchor"></a>Dask</h4>
<p>To test Dask</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb10-1" title="1"><span class="im">import</span> dask.dataframe <span class="im">as</span> dd</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="im">from</span> datetime <span class="im">import</span> datetime</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4">a <span class="op">=</span> dd.read_csv(<span class="st">"c:/data/perf/Performance_2004Q3.txt"</span>, sep<span class="op">=</span><span class="st">"|"</span>,</a>
<a class="sourceLine" id="cb10-5" title="5">                dtype<span class="op">=</span>{<span class="dv">7</span>: <span class="st">'double'</span>, <span class="dv">14</span>: <span class="st">'str'</span>, <span class="dv">15</span>: <span class="st">'str'</span>, <span class="dv">16</span>:<span class="st">'str'</span>}, header <span class="op">=</span> <span class="va">None</span>)</a>
<a class="sourceLine" id="cb10-6" title="6">a.columns <span class="op">=</span> [<span class="st">"var"</span> <span class="op">+</span> <span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Control">in</a></span> <span class="bu">range</span>(<span class="dv">31</span>)]</a>
<a class="sourceLine" id="cb10-7" title="7">a.head()</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9">startTime <span class="op">=</span> datetime.now()</a>
<a class="sourceLine" id="cb10-10" title="10">a.to_parquet(<span class="st">"c:/data/p03.parquet"</span>)</a>
<a class="sourceLine" id="cb10-11" title="11"><span class="bu">print</span>(datetime.now() <span class="op">-</span> startTime)  <span class="co"># 50 seconds</span></a></code></pre></div>
<p>and we can see tht converting to Parquet takes more time than <code>csv_to_disk.frame</code>. Now to test Dask’s ability to aggregate a simple use-case, we can also load only column into RAM to speed up the analysis.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb11-1" title="1">startTime <span class="op">=</span> datetime.now()</a>
<a class="sourceLine" id="cb11-2" title="2">a <span class="op">=</span> dd.read_parquet(<span class="st">"c:/data/p03.parquet"</span>, columns<span class="op">=</span><span class="st">"var0"</span>)</a>
<a class="sourceLine" id="cb11-3" title="3">aa <span class="op">=</span> a.value_counts().compute()</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="bu">print</span>(datetime.now() <span class="op">-</span> startTime)  <span class="co"># 1.2</span></a></code></pre></div>
<p>The aggregation time is also longer, although in practice 1.2s. vs around 0.5s isn’t that big of a difference. We shall see how the differential changes when dealing with larger datasets in a future session.</p>
<div id="dask-is-good" class="section level5">
<h5 class="hasAnchor">
<a href="#dask-is-good" class="anchor"></a>Dask is good</h5>
<p>A good feature of Dask is that you need not convert the data to parquet before doing the aggregation. This is a very convenient feature that is not available in disk.frame yet. For example:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb12-1" title="1">startTime <span class="op">=</span> datetime.now()</a>
<a class="sourceLine" id="cb12-2" title="2">a <span class="op">=</span> dd.read_csv(<span class="st">"c:/data/perf/Performance_2004Q3.txt"</span>, sep<span class="op">=</span><span class="st">"|"</span>,</a>
<a class="sourceLine" id="cb12-3" title="3">                dtype<span class="op">=</span>{<span class="dv">7</span>: <span class="st">'double'</span>, <span class="dv">14</span>: <span class="st">'str'</span>, <span class="dv">15</span>: <span class="st">'str'</span>, <span class="dv">16</span>:<span class="st">'str'</span>}, header <span class="op">=</span> <span class="va">None</span>)</a>
<a class="sourceLine" id="cb12-4" title="4">a.columns <span class="op">=</span> [<span class="st">"var"</span> <span class="op">+</span> <span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Control">in</a></span> <span class="bu">range</span>(<span class="dv">31</span>)]</a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6">startTime <span class="op">=</span> datetime.now()</a>
<a class="sourceLine" id="cb12-7" title="7">a.var0.value_counts().compute()</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="bu">print</span>(datetime.now() <span class="op">-</span> startTime)  <span class="co"># 50 seconds</span></a></code></pre></div>
<p>However this strategy is not particularly fast. In practice, you are almost always better off spending some time to convert your data to a efficient format before performing analysis. This may have a time cost, but the effort will pay off very quickly.</p>
</div>
</div>
<div id="juliadb" class="section level4">
<h4 class="hasAnchor">
<a href="#juliadb" class="anchor"></a>JuliaDB</h4>
<p>I really like Julia but it’s a shame that JuliaDB is no where near as mature as either disk.frame nor Dask for inputting data. I have not been able to load the CSV using JuliaDB’s native methods and have resorted to using CSV.jl to read the data and convert it to JuliaDB.jl. Also, it’s difficult to figure out how to run JuliaDB from disk, and the memory usage is enormous compared to the disk.frame’s and Dask’s.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb13-1" title="1">using JuliaDB, CSV, OnlineStats</a>
<a class="sourceLine" id="cb13-2" title="2">path = <span class="st">"c:/data/perf"</span></a>
<a class="sourceLine" id="cb13-3" title="3"></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co"># read data using CSV.jl and convert to JuliaDB</span></a>
<a class="sourceLine" id="cb13-5" title="5">@time df = CSV.File(joinpath(path, <span class="st">"Performance_2004Q3.txt"</span>), delim = <span class="ch">'|'</span>, header = false) |&gt; JuliaDB.table <span class="co"># 48</span></a></code></pre></div>
<p>Once the data has been loaded, I can aggregate as follows</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb14-1" title="1">using LambdaFn</a>
<a class="sourceLine" id="cb14-2" title="2">@time groupby(@λ(size(_,<span class="fl">1</span>)), a, :Column1) <span class="co"># 6</span></a></code></pre></div>
<p>Unfortunately, it’s much slower than both disk.frame and Dask.</p>
<p>As a side note, I can use OnlineStats.jl to do aggregation (relatively) efficiently. I think OnlineStats is one of the bright spots for JuliaDB, as it has powerful online-algorithms that allows you to combine statistics by computing those statistics in chunks and combining the resutls from each chunk. It’s a shame that JuliaDB is not mature enough to make it shine more brightly. For an example of what it can do, see the example to compute the mean of <code>Column6</code> grouped by <code>Column1</code></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb15-1" title="1">@time groupreduce(Mean(), a, :Column1, select = :Column6)</a></code></pre></div>
<p>You may have noticed that we have not converted JuliaDB.jl to disk. Here we will try that</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb16-1" title="1">@time JuliaDB.save(a, <span class="st">"c:/data/.jldb"</span>) <span class="co"># 26s</span></a></code></pre></div>
<p>Together with the time taken to read the data in (48s), we can say that the time to read and convert to the JuliaDB format is 48s + 28s = 76s. The issue with this conversion is that we are still not able to load only the column we need for the analysis. Random access to columns are possible with disk.frame and Dask.</p>
<p>Also, it’s astounding that the output file is 17GB in size and the original CSV was only 2.5GB! Loading the data takes about 9s, but uses up a lot of RAM. I think it will take time for JuliaDB to mature.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode julia"><code class="sourceCode julia"><a class="sourceLine" id="cb17-1" title="1">@time a = JuliaDB.load(<span class="st">"c:/data/.jldb"</span>) <span class="co"># 0s</span></a></code></pre></div>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>It is somewhat surprising that disk.frame is the speed king in this benchmark study, but I can’t take any of the credit as the speediness of disk.frame is due to the authors of fst, future (and parallel), and data.table. It’s also no surprise that Julia’s medium-data tool lags behind Python’s and R’s, because it’s a pattern noticed elsewhere in the data ecosystem. Julia’s niche and strength at this point is in computational problems that require lots of computation that do not necessarily invovled large amounts of input data (the Celeste project appears to be an exception but I think the computational demand there dominate the data demand).</p>
<p>Although disk.frame is the fastest, it’s syntax is not as convenient as Dask’s. Using Dask is almost the same as using pandas. In contrast, when using disk.frame, the user needs to be aware that operations happen in chunks, and hence a “two-stage” group-by is required. However, this will be addressed in a future planned package disk.frame.db which is will allow the user to “forget” the underlying architecture is made of chunks, and just focus on higher-level data operations.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#intro">Intro</a></li>
      <li>
<a href="#tldr">TL;DR</a><ul class="nav nav-pills nav-stacked">
<li><a href="#data">Data</a></li>
      <li><a href="#benchmark-exercise-converting-csv-to-desired-format-and-simple-aggregation">Benchmark exercise: converting CSV to desired format and simple aggregation</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Dai ZJ.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
