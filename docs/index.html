<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Larger-than-RAM Disk-Based Data Manipulation Framework • disk.frame</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Larger-than-RAM Disk-Based Data Manipulation Framework">
<meta property="og:description" content="A disk-based data manipulation tool for working with 
  large-than-RAM datasets. Aims to lower the barrier-to-entry for 
  manipulating large datasets by adhering closely to popular and 
  familiar data manipulation paradigms like dplyr verbs and 
  data.table syntax.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">disk.frame</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1.999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/concepts.html">Concepts for disk.frame</a>
    </li>
    <li>
      <a href="articles/data-table-syntax.html">Using data.table syntax with disk.frame</a>
    </li>
    <li>
      <a href="articles/glm.html">Generalized Linear Models (GLM) including logistic regression with disk.frame</a>
    </li>
    <li>
      <a href="articles/ingesting-data.html">Ingesting Data</a>
    </li>
    <li>
      <a href="articles/intro-disk-frame.html">Quick Start: Basic Operations with nycflights13</a>
    </li>
    <li>
      <a href="articles/intro.html">Preface - The birth of `disk.frame`</a>
    </li>
    <li>
      <a href="articles/more-epic.html">{disk.frame} can be more 'epic'</a>
    </li>
    <li>
      <a href="articles/vs-dask-juliadb.html">Benchmarks 1: disk.frame beats Dask! disk.frame beats JuliaDB! Anyone else wanna challenge?</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="diskframe-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#diskframe-" class="anchor"></a>disk.frame <img src="inst/figures/disk.frame.png" align="right">
</h1></div>

<details><summary>Please take a moment to star the disk.frame Github repo if you
like disk.frame. It keeps me going.</summary><iframe src="https://ghbtns.com/github-btn.html?user=xiaodaigh&amp;repo=disk.frame&amp;type=star&amp;count=true&amp;size=large" frameborder="0" scrolling="0" width="160px" height="30px"></iframe>

</details><!-- badges: start --><!-- ![disk.frame logo](inst/figures/disk.frame.png?raw=true "disk.frame logo") --><!-- badges: end -->
</div>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>disk.frame</code> package aims to be the answer to the question: how do I manipulate structured tabular data that doesn’t fit into Random Access Memory (RAM)?</p>
<p>In a nutshell, <code>disk.frame</code> makes use of two simple ideas</p>
<p>1) split up a larger-than-RAM dataset into chunks and store each chunk in a separate file inside a folder and 2) provide a convenient API to manipulate these chunks</p>
<p><code>disk.frame</code> performs a similar role to distributed systems such as Apache Spark, Python’s Dask, and Julia’s JuliaDB.jl for <em>medium data</em> which are datasets that are too large for RAM but not quite large enough to qualify as <em>big data</em> that require distributing processing over many computers to be effective.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of disk.frame from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"disk.frame"</span>)</span></code></pre></div>
<p>And the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># install.packages("devtools")</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"xiaodaigh/disk.frame"</span>)</span></code></pre></div>
</div>
<div id="vignettes-and-articles" class="section level2">
<h2 class="hasAnchor">
<a href="#vignettes-and-articles" class="anchor"></a>Vignettes and articles</h2>
<p>Please see these vignettes and articles about <code>disk.frame</code></p>
<ul>
<li>
<a href="http://daizj.net/disk.frame/articles/intro-disk-frame.html">Quick start: disk.frame</a> which replicates the <code>sparklyr</code> vignette for manipulating the <code>nycflights13</code> flights data.</li>
<li>
<a href="http://diskframe.com/articles/ingesting-data.html">Ingesting data into disk.frame</a> which lists some commons way of creating disk.frames</li>
<li>
<a href="http://diskframe.com/articles/glm.html">Fitting GLMs (including logistic regression)</a> introduces the <code>dfglm</code> function for fitting generalised linear models</li>
<li><a href="http://diskframe.com/articles/data-table-syntax.html">Using data.table syntax with disk.frame</a></li>
<li><a href="http://diskframe.com/articles/concepts.html">disk.frame concepts</a></li>
<li><a href="http://diskframe.com/articles/vs-dask-juliadb.html">Benchmark 1: disk.frame vs Dask vs JuliaDB</a></li>
</ul>
<div id="interested-in-learning-diskframe-in-a-structured-course" class="section level3">
<h3 class="hasAnchor">
<a href="#interested-in-learning-diskframe-in-a-structured-course" class="anchor"></a>Interested in learning {disk.frame} in a structured course?</h3>
<p>Please register your interest at:</p>
<p><a href="https://leanpub.com/c/taminglarger-than-ramwithdiskframe" class="uri">https://leanpub.com/c/taminglarger-than-ramwithdiskframe</a></p>
</div>
</div>
<div id="common-questions" class="section level2">
<h2 class="hasAnchor">
<a href="#common-questions" class="anchor"></a>Common questions</h2>
<div id="a-what-is-diskframe-and-why-create-it" class="section level3">
<h3 class="hasAnchor">
<a href="#a-what-is-diskframe-and-why-create-it" class="anchor"></a>a) What is <code>disk.frame</code> and why create it?</h3>
<p><code>disk.frame</code> is an R package that provides a framework for manipulating larger-than-RAM structured tabular data on disk efficiently. The reason one would want to manipulate data on disk is that it allows arbitrarily large datasets to be processed by R. In other words, we go from “R can only deal with data that fits in RAM” to “R can deal with any data that fits on disk”. See the next section.</p>
</div>
<div id="b-how-is-it-different-to-dataframe-and-datatable" class="section level3">
<h3 class="hasAnchor">
<a href="#b-how-is-it-different-to-dataframe-and-datatable" class="anchor"></a>b) How is it different to <code>data.frame</code> and <code>data.table</code>?</h3>
<p>A <code>data.frame</code> in R is an in-memory data structure, which means that R must load the data in its entirety into RAM. A corollary of this is that only data that can fit into RAM can be processed using <code>data.frame</code>s. This places significant restrictions on what R can process with minimal hassle.</p>
<p>In contrast, <code>disk.frame</code> provides a framework to store and manipulate data on the hard drive. It does this by loading only a small part of the data, called a chunk, into RAM; process the chunk, write out the results and repeat with the next chunk. This chunking strategy is widely applied in other packages to enable processing large amounts of data in R, for example, see <a href="https://github.com/edwindj/chunked"><code>chunkded</code></a> <a href="https://github.com/ropensci/arkdb"><code>arkdb</code></a>, and <a href="https://github.com/s-u/iotools"><code>iotools</code></a>.</p>
<p>Furthermore, there is a row-limit of 2^31 for <code>data.frame</code>s in R; hence an alternate approach is needed to apply R to these large datasets. The chunking mechanism in <code>disk.frame</code> provides such an avenue to enable data manipulation beyond the 2^31 row limit.</p>
</div>
<div id="c-how-is-diskframe-different-to-previous-big-data-solutions-for-r" class="section level3">
<h3 class="hasAnchor">
<a href="#c-how-is-diskframe-different-to-previous-big-data-solutions-for-r" class="anchor"></a>c) How is <code>disk.frame</code> different to previous “big” data solutions for R?</h3>
<p>R has many packages that can deal with larger-than-RAM datasets, including <code>ff</code> and <code>bigmemory</code>. However, <code>ff</code> and <code>bigmemory</code> restrict the user to primitive data types such as double, which means they do not support character (string) and factor types. In contrast, <code>disk.frame</code> makes use of <code><a href="https://rdrr.io/pkg/data.table/man/data.table.html">data.table::data.table</a></code> and <code>data.frame</code> directly, so all data types are supported. Also, <code>disk.frame</code> strives to provide an API that is as similar to <code>data.frame</code>’s where possible. <code>disk.frame</code> supports many <code>dplyr</code> verbs for manipulating <code>disk.frame</code>s.</p>
<p>Additionally, <code>disk.frame</code> supports parallel data operations using infrastructures provided by the excellent <a href="https://CRAN.R-project.org/package=future"><code>future</code> package</a> to take advantage of multi-core CPUs. Further, <code>disk.frame</code> uses state-of-the-art data storage techniques such as fast data compression, and random access to rows and columns provided by the <a href="http://www.fstpackage.org/"><code>fst</code> package</a> to provide superior data manipulation speeds.</p>
</div>
<div id="d-how-does-diskframe-work" class="section level3">
<h3 class="hasAnchor">
<a href="#d-how-does-diskframe-work" class="anchor"></a>d) How does <code>disk.frame</code> work?</h3>
<p><code>disk.frame</code> works by breaking large datasets into smaller individual chunks and storing the chunks in <code>fst</code> files inside a folder. Each chunk is a <code>fst</code> file containing a <code>data.frame/data.table</code>. One can construct the original large dataset by loading all the chunks into RAM and row-bind all the chunks into one large <code>data.frame</code>. Of course, in practice this isn’t always possible; hence why we store them as smaller individual chunks.</p>
<p><code>disk.frame</code> makes it easy to manipulate the underlying chunks by implementing <code>dplyr</code> functions/verbs and other convenient functions (e.g. the <code><a href="reference/map.html">map.disk.frame(a.disk.frame, fn, lazy = F)</a></code> function which applies the function <code>fn</code> to each chunk of <code>a.disk.frame</code> in parallel). So that <code>disk.frame</code> can be manipulated in a similar fashion to in-memory <code>data.frame</code>s.</p>
</div>
<div id="e-how-is-diskframe-different-from-spark-dask-and-juliadbjl" class="section level3">
<h3 class="hasAnchor">
<a href="#e-how-is-diskframe-different-from-spark-dask-and-juliadbjl" class="anchor"></a>e) How is <code>disk.frame</code> different from Spark, Dask, and JuliaDB.jl?</h3>
<p>Spark is primarily a distributed system that also works on a single machine. Dask is a Python package that is most similar to <code>disk.frame</code>, and JuliaDB.jl is a Julia package. All three can distribute work over a cluster of computers. However, <code>disk.frame</code> currently cannot distribute data processes over many computers, and is, therefore, single machine focused.</p>
<p>In R, one can access Spark via <code>sparklyr</code>, but that requires a Spark cluster to be set up. On the other hand <code>disk.frame</code> requires zero-setup apart from running <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("disk.frame")</a></code> or <code><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">devtools::install_github("xiaodaigh/disk.frame")</a></code>.</p>
<p>Finally, Spark can only apply functions that are implemented for Spark, whereas <code>disk.frame</code> can use any function in R including user-defined functions.</p>
</div>
<div id="f-how-is-diskframe-different-from-multidplyr-partools-and-distributedr" class="section level3">
<h3 class="hasAnchor">
<a href="#f-how-is-diskframe-different-from-multidplyr-partools-and-distributedr" class="anchor"></a>f) How is <code>disk.frame</code> different from multidplyr, partools and distributedR?</h3>
<p>The packages <a href="https://github.com/tidyverse/multidplyr">multidplyr</a> doesn’t seem to be disk-focused and hence does not allow arbitrarily large dataset to be manipulated; the focus on parallel processing is similar to disk.frame though. For partools [<a href="https://matloff.wordpress.com/2015/08/05/partools-a-sensible-r-package-for-large-data-sets/" class="uri">https://matloff.wordpress.com/2015/08/05/partools-a-sensible-r-package-for-large-data-sets/</a>], it seems to use it’s own verbs for aggregating data instead of relying on existing verbs provided by data.table and dplyr. The package <a href="https://github.com/vertica/DistributedR"><code>distributedR</code></a> hasn’t been updated for a few years and also seems to require its own functions and verbs.</p>
</div>
</div>
<div id="set-up-diskframe" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up-diskframe" class="anchor"></a>Set-up <code>disk.frame</code>
</h2>
<p><code>disk.frame</code> works best if it can process multiple data chunks in parallel. The best way to set-up <code>disk.frame</code> so that each CPU core runs a background worker is by using</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="reference/setup_disk.frame.html">setup_disk.frame</a></span>()</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co"># this allows large datasets to be transferred between sessions</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">future.globals.maxSize =</span> <span class="ot">Inf</span>)</span></code></pre></div>
<p>The <code><a href="reference/setup_disk.frame.html">setup_disk.frame()</a></code> sets up background workers equal to the number of CPU cores; please note that, by default, hyper-threaded cores are counted as one not two.</p>
<p>Alternatively, one may specify the number of workers using <code><a href="reference/setup_disk.frame.html">setup_disk.frame(workers = n)</a></code>.</p>
</div>
</div>
<div id="example-usage" class="section level1">
<h1 class="hasAnchor">
<a href="#example-usage" class="anchor"></a>Example usage</h1>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(disk.frame)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#&gt; Loading required package: dplyr</span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; </span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt; </span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; </span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; Loading required package: purrr</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; Registered S3 method overwritten by 'pryr':</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt;   method      from</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt;   print.bytes Rcpp</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; </span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; ## Message from disk.frame:</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; We have 1 workers to use with disk.frame.</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; To change that, use setup_disk.frame(workers = n) or just setup_disk.frame() to use the defaults.</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; </span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; </span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; It is recommend that you run the following immediately to setup disk.frame with multiple workers in order to parallelize your operations:</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; </span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt; </span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#&gt; ```r</span></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="co">#&gt; # this willl set disk.frame with multiple workers</span></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="co">#&gt; setup_disk.frame()</span></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="co">#&gt; # this will allow unlimited amount of data to be passed from worker to worker</span></span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="co">#&gt; options(future.globals.maxSize = Inf)</span></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="co">#&gt; ```</span></span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="co">#&gt; </span></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="co">#&gt; Attaching package: 'disk.frame'</span></span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="co">#&gt; The following objects are masked from 'package:purrr':</span></span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="co">#&gt; </span></span>
<span id="cb4-34"><a href="#cb4-34"></a><span class="co">#&gt;     imap, imap_dfr, map, map_dfr, map2</span></span>
<span id="cb4-35"><a href="#cb4-35"></a><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span id="cb4-36"><a href="#cb4-36"></a><span class="co">#&gt; </span></span>
<span id="cb4-37"><a href="#cb4-37"></a><span class="co">#&gt;     colnames, ncol, nrow</span></span>
<span id="cb4-38"><a href="#cb4-38"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(nycflights13)</span>
<span id="cb4-39"><a href="#cb4-39"></a></span>
<span id="cb4-40"><a href="#cb4-40"></a><span class="co"># this will setup disk.frame's parallel backend with number of workers equal to the number of CPU cores (hyper-threaded cores are counted as one not two)</span></span>
<span id="cb4-41"><a href="#cb4-41"></a><span class="kw"><a href="reference/setup_disk.frame.html">setup_disk.frame</a></span>()</span>
<span id="cb4-42"><a href="#cb4-42"></a><span class="co">#&gt; The number of workers available for disk.frame is 6</span></span>
<span id="cb4-43"><a href="#cb4-43"></a><span class="co"># this allows large datasets to be transferred between sessions</span></span>
<span id="cb4-44"><a href="#cb4-44"></a><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">future.globals.maxSize =</span> <span class="ot">Inf</span>)</span>
<span id="cb4-45"><a href="#cb4-45"></a></span>
<span id="cb4-46"><a href="#cb4-46"></a><span class="co"># convert the flights data.frame to a disk.frame</span></span>
<span id="cb4-47"><a href="#cb4-47"></a><span class="co"># optionally, you may specify an outdir, otherwise, the </span></span>
<span id="cb4-48"><a href="#cb4-48"></a>flights.df &lt;-<span class="st"> </span><span class="kw"><a href="reference/as.disk.frame.html">as.disk.frame</a></span>(nycflights13<span class="op">::</span>flights)</span></code></pre></div>
<p>To find out where the disk.frame is stored on disk:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># where is the disk.frame stored</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(flights.df, <span class="st">"path"</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; [1] "C:\\Users\\RTX2080\\AppData\\Local\\Temp\\Rtmp6J5pkQ\\filef404a533825.df"</span></span></code></pre></div>
<p>A number of data.frame functions are implemented for disk.frame</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># get first few rows</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flights.df)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt;    year month day dep_time sched_dep_time dep_delay arr_time</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt; 1: 2013     1   1      517            515         2      830</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; 2: 2013     1   1      533            529         4      850</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; 3: 2013     1   1      542            540         2      923</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt; 4: 2013     1   1      544            545        -1     1004</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; 5: 2013     1   1      554            600        -6      812</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; 6: 2013     1   1      554            558        -4      740</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;    sched_arr_time arr_delay carrier flight tailnum origin dest air_time</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; 1:            819        11      UA   1545  N14228    EWR  IAH      227</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; 2:            830        20      UA   1714  N24211    LGA  IAH      227</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; 3:            850        33      AA   1141  N619AA    JFK  MIA      160</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; 4:           1022       -18      B6    725  N804JB    JFK  BQN      183</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; 5:            837       -25      DL    461  N668DN    LGA  ATL      116</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; 6:            728        12      UA   1696  N39463    EWR  ORD      150</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt;    distance hour minute           time_hour</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt; 1:     1400    5     15 2013-01-01 05:00:00</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt; 2:     1416    5     29 2013-01-01 05:00:00</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt; 3:     1089    5     40 2013-01-01 05:00:00</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt; 4:     1576    5     45 2013-01-01 05:00:00</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">#&gt; 5:      762    6      0 2013-01-01 06:00:00</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">#&gt; 6:      719    5     58 2013-01-01 05:00:00</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># get last few rows</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(flights.df)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt;    year month day dep_time sched_dep_time dep_delay arr_time</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; 1: 2013     9  30       NA           1842        NA       NA</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; 2: 2013     9  30       NA           1455        NA       NA</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; 3: 2013     9  30       NA           2200        NA       NA</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; 4: 2013     9  30       NA           1210        NA       NA</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; 5: 2013     9  30       NA           1159        NA       NA</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; 6: 2013     9  30       NA            840        NA       NA</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt;    sched_arr_time arr_delay carrier flight tailnum origin dest air_time</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; 1:           2019        NA      EV   5274  N740EV    LGA  BNA       NA</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt; 2:           1634        NA      9E   3393    &lt;NA&gt;    JFK  DCA       NA</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt; 3:           2312        NA      9E   3525    &lt;NA&gt;    LGA  SYR       NA</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt; 4:           1330        NA      MQ   3461  N535MQ    LGA  BNA       NA</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt; 5:           1344        NA      MQ   3572  N511MQ    LGA  CLE       NA</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt; 6:           1020        NA      MQ   3531  N839MQ    LGA  RDU       NA</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt;    distance hour minute           time_hour</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt; 1:      764   18     42 2013-09-30 18:00:00</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">#&gt; 2:      213   14     55 2013-09-30 14:00:00</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">#&gt; 3:      198   22      0 2013-09-30 22:00:00</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">#&gt; 4:      764   12     10 2013-09-30 12:00:00</span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">#&gt; 5:      419   11     59 2013-09-30 11:00:00</span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&gt; 6:      431    8     40 2013-09-30 08:00:00</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># number of rows</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw"><a href="reference/ncol_nrow.html">nrow</a></span>(flights.df)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt; [1] 336776</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># number of columns</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw"><a href="reference/ncol_nrow.html">ncol</a></span>(flights.df)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">#&gt; [1] 19</span></span></code></pre></div>
<div id="example-dplyr-verbs" class="section level2">
<h2 class="hasAnchor">
<a href="#example-dplyr-verbs" class="anchor"></a>Example: dplyr verbs</h2>
<div id="group-by" class="section level3">
<h3 class="hasAnchor">
<a href="#group-by" class="anchor"></a>Group by</h3>
<p>Group-by in disk.frame are performed within each chunk, hence a two-stage group by is required to obtain the correct group by results. The two-stage approach is preferred for performance reasons too.</p>
<p>To perform group-by one needs to do it in two-stage approach as the group-bys are performed within each chunk. This will be addressed in a future package called <code>disk.frame.db</code>, but for now two-stage aggregation is the best to do group-bys in <code>disk.frame</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>flights.df =<span class="st"> </span><span class="kw"><a href="reference/as.disk.frame.html">as.disk.frame</a></span>(nycflights13<span class="op">::</span>flights)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>flights.df <span class="op">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">  </span><span class="kw"><a href="reference/srckeep.html">srckeep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>,<span class="st">"distance"</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># keep only carrier and distance columns</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dist =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(distance)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># this does a count per chunk</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="st">  </span>collect</span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt; # A tibble: 6 x 2</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt;    year sum_dist</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt;   &lt;int&gt;    &lt;dbl&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt; 1  2013 57446059</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt; 2  2013 59302212</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt; 3  2013 56585094</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt; 4  2013 58476357</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt; 5  2013 59407019</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt; 6  2013 59000866</span></span></code></pre></div>
<p>This is two-stage group-by in action</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># need a 2nd stage to finalise summing</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>flights.df <span class="op">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw"><a href="reference/srckeep.html">srckeep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"year"</span>,<span class="st">"distance"</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># keep only carrier and distance columns</span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dist =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(distance)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># this does a count per chunk</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">  </span>collect <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dist =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(sum_dist))</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; # A tibble: 1 x 2</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt;    year  sum_dist</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt;   &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; 1  2013 350217607</span></span></code></pre></div>
<p>Here an example of using <code>filter</code></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># filter</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>pt =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/proc.time.html">proc.time</a></span>()</span>
<span id="cb12-3"><a href="#cb12-3"></a>df_filtered &lt;-</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="st">  </span>flights.df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"filtering a &lt; 0.1 took: "</span>, data.table<span class="op">::</span><span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt; filtering a &lt; 0.1 took:  0.020s elapsed (0.020s cpu)</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="kw"><a href="reference/ncol_nrow.html">nrow</a></span>(df_filtered)</span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt; [1] 336776</span></span></code></pre></div>
<p>You can mix group-by with other dplyr verbs as below</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>pt =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/proc.time.html">proc.time</a></span>()</span>
<span id="cb13-2"><a href="#cb13-2"></a>res1 &lt;-<span class="st"> </span>flights.df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw"><a href="reference/srckeep.html">srckeep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"month"</span>, <span class="st">"dep_delay"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">qtr =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>, <span class="st">"Q1"</span>, <span class="st">"Q2"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="st">  </span><span class="kw">group_by</span>(qtr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_delay =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="st">  </span>collect <span class="op">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="st">  </span><span class="kw">group_by</span>(qtr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_delay =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(sum_delay), <span class="dt">n =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">avg_delay =</span> sum_delay<span class="op">/</span>n)</span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"group by took: "</span>, data.table<span class="op">::</span><span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt; group by took:  0.560s elapsed (0.140s cpu)</span></span>
<span id="cb13-14"><a href="#cb13-14"></a></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="kw">collect</span>(res1)</span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt; # A tibble: 2 x 4</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">#&gt;   qtr   sum_delay     n avg_delay</span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt; 1 Q1       892053 80789      11.0</span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">#&gt; 2 Q2      1319941 85369      15.5</span></span></code></pre></div>
<p>However, a one-stage <code>group_by</code> is possible with a <code>hard_group_by</code> to first rechunk the disk.frame. This <strong>not</strong> recommended for performance reasons, as it can quite slow.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>pt =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/proc.time.html">proc.time</a></span>()</span>
<span id="cb14-2"><a href="#cb14-2"></a>res1 &lt;-<span class="st"> </span>flights.df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="st">  </span><span class="kw"><a href="reference/srckeep.html">srckeep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"month"</span>, <span class="st">"dep_delay"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">6</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">qtr =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>, <span class="st">"Q1"</span>, <span class="st">"Q2"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="st">  </span><span class="kw"><a href="reference/hard_group_by.html">hard_group_by</a></span>(qtr) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># hard group_by is MUCH SLOWER but avoid a 2nd stage aggregation</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_delay =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="st">  </span>collect</span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt; Appending disk.frames:</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"group by took: "</span>, data.table<span class="op">::</span><span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt; group by took:  1.140s elapsed (0.250s cpu)</span></span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="kw">collect</span>(res1)</span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt; # A tibble: 2 x 2</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#&gt;   qtr   avg_delay</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co">#&gt; 1 Q1         11.4</span></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co">#&gt; 2 Q2         15.9</span></span></code></pre></div>
</div>
</div>
<div id="example-datatable-syntax" class="section level2">
<h2 class="hasAnchor">
<a href="#example-datatable-syntax" class="anchor"></a>Example: data.table syntax</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(data.table)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="co">#&gt; </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co">#&gt; Attaching package: 'data.table'</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co">#&gt; The following object is masked from 'package:purrr':</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#&gt; </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt;     transpose</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt; The following objects are masked from 'package:dplyr':</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">#&gt; </span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">#&gt;     between, first, last</span></span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a>grp_by_stage1 =<span class="st"> </span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="st">  </span>flights.df[</span>
<span id="cb15-13"><a href="#cb15-13"></a>    keep =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"month"</span>, <span class="st">"distance"</span>), <span class="co"># this analysis only required "month" and "dist" so only load those</span></span>
<span id="cb15-14"><a href="#cb15-14"></a>    month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">6</span>, </span>
<span id="cb15-15"><a href="#cb15-15"></a>    .(<span class="dt">sum_dist =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(distance)), </span>
<span id="cb15-16"><a href="#cb15-16"></a>    .(<span class="dt">qtr =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(month <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>, <span class="st">"Q1"</span>, <span class="st">"Q2"</span>))</span>
<span id="cb15-17"><a href="#cb15-17"></a>    ]</span>
<span id="cb15-18"><a href="#cb15-18"></a></span>
<span id="cb15-19"><a href="#cb15-19"></a>grp_by_stage1</span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">#&gt;    qtr sum_dist</span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co">#&gt; 1:  Q1 27188805</span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="co">#&gt; 2:  Q1   953578</span></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co">#&gt; 3:  Q1 53201567</span></span>
<span id="cb15-24"><a href="#cb15-24"></a><span class="co">#&gt; 4:  Q2  3383527</span></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="co">#&gt; 5:  Q2 58476357</span></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="co">#&gt; 6:  Q2 27397926</span></span></code></pre></div>
<p>The result <code>grp_by_stage1</code> is a <code>data.table</code> so we can finish off the two-stage aggregation using data.table syntax</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>grp_by_stage2 =<span class="st"> </span>grp_by_stage1[,.(<span class="dt">sum_dist =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(sum_dist)), qtr]</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>grp_by_stage2</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co">#&gt;    qtr sum_dist</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">#&gt; 1:  Q1 81343950</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">#&gt; 2:  Q2 89257810</span></span></code></pre></div>
</div>
<div id="hex-logo" class="section level2">
<h2 class="hasAnchor">
<a href="#hex-logo" class="anchor"></a>Hex logo</h2>
<p><img src="inst/figures/logo.png?raw=true" alt="disk.frame logo"></p>
</div>
<div id="contributors" class="section level2">
<h2 class="hasAnchor">
<a href="#contributors" class="anchor"></a>Contributors</h2>
<p>This project exists thanks to all the people who contribute. <a href="https://github.com/xiaodaigh/disk.frame/graphs/contributors"><img src="https://opencollective.com/diskframe/contributors.svg?width=890&amp;button=false"></a></p>
</div>
<div id="current-priorities" class="section level2">
<h2 class="hasAnchor">
<a href="#current-priorities" class="anchor"></a>Current Priorities</h2>
<p>The work priorities at this stage are 1. Bugs and urgent feature implementations 2. More vignettes covering every aspect of disk.frame 3. Comprehensive Tests 4. Comprehensive Documentation 5. More features</p>
</div>
<div id="open-collective" class="section level2">
<h2 class="hasAnchor">
<a href="#open-collective" class="anchor"></a>Open Collective</h2>
<p>If you like disk.frame and want to speed up its development or perhaps you have a feature request? Please consider sponsoring me on Open Collective</p>
<div id="backers" class="section level3">
<h3 class="hasAnchor">
<a href="#backers" class="anchor"></a>Backers</h3>
<p>Thank you to all our backers! 🙏 [<a href="https://opencollective.com/diskframe#backer">Become a backer</a>]</p>
<p><a href="https://opencollective.com/diskframe#backers" target="_blank"><img src="https://opencollective.com/diskframe/backers.svg?width=890"></a></p>
<p><a href="#backers"><img src="https://opencollective.com/diskframe/backers/badge.svg" alt="Backers on Open Collective"></a></p>
</div>
<div id="sponsors" class="section level3">
<h3 class="hasAnchor">
<a href="#sponsors" class="anchor"></a>Sponsors</h3>
<p>Support this project by becoming a sponsor. Your logo will show up here with a link to your website. [<a href="https://opencollective.com/diskframe#sponsor">Become a sponsor</a>]</p>
<p><a href="#sponsors"><img src="https://opencollective.com/diskframe/sponsors/badge.svg" alt="Sponsors on Open Collective"></a></p>
</div>
</div>
<div id="contact-me-for-consulting" class="section level2">
<h2 class="hasAnchor">
<a href="#contact-me-for-consulting" class="anchor"></a>Contact me for consulting</h2>
<p><strong>Do you need help with machine learning and data science in R, Python, or Julia?</strong> <a href="https://www.codementor.io/evalparse"><img src="https://cdn.codementor.io/badges/contact_me_github.svg" alt="Contact me on Codementor"></a></p>
<p>I am available for Machine Learning/Data Science/R/Python/Julia consulting! <a href="mailto:dzj@analytixware.com">Email me</a> to get 10% discount off the hourly rate.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=disk.frame">https://​cloud.r-project.org/​package=disk.frame</a>
</li>
<li>Report a bug at <br><a href="https://github.com/xiaodaigh/disk.frame/issues">https://​github.com/​xiaodaigh/​disk.frame/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Dai ZJ <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=disk.frame"><embed src="https://cranlogs.r-pkg.org/badges/disk.frame"></embed></a></li>
<li><a href="https://cran.r-project.org/package=disk.frame"><embed src="http://cranlogs.r-pkg.org/badges/grand-total/disk.frame"></embed></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Dai ZJ.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
