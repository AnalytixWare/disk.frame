<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast disk-based data manipulation framework for larger-than-RAM structured tabular data • disk.frame</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Fast disk-based data manipulation framework for larger-than-RAM structured tabular data">
<meta property="og:description" content="Disk.frame allows the user to process arbitrarily
    large datasets on disk chunk-wise without loading the whole file into
    RAM. This enables large datasets to be processed and analysed.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">disk.frame</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/intro-disk-frame.html">Introduction to `disk.frame` - larger-than-RAM data manipulation framework</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="contents col-md-9">

<p><img src="disk.frame.png?raw=true" title="disk.frame logo" alt="disk.frame logo"></p>
<div id="introduction" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1></div>
<p>The <code>disk.frame</code> package aims to be the answer to the question: how do I manipulate structured tabular data that doesn’t fit into Random Access Memory (RAM)?</p>
<p>In a nutshell, <code>disk.frame</code> makes use of two simple ideas</p>
<p>1) split up a larger-than-RAM dataset into chunks and store each chunk in a separate file inside a folder and 2) provide a convenient API to manipulate these chunks</p>
<p><code>disk.frame</code> performs a similar role to distributed systems such as Apache Spark, Python’s Dask, and Julia’s JuliaDB.jl for <em>medium data</em> which are datasets that are too large for RAM but not quite large enough to qualify as <em>big data</em> that require distributing processing over many computers to be effective.</p>
<div id="vignette" class="section level2">
<h2 class="hasAnchor">
<a href="#vignette" class="anchor"></a>Vignette</h2>
<p>Please see this vignette <a href="https://rpubs.com/xiaodai/intro-disk-frame">Introduction to disk.frame</a> which replicates the <code>sparklyr</code> vignette for manipulating the <code>nycflights13</code> flights data.</p>
</div>
<div id="common-questions" class="section level2">
<h2 class="hasAnchor">
<a href="#common-questions" class="anchor"></a>Common questions</h2>
<div id="a-what-is-disk-frame-and-why-create-it" class="section level3">
<h3 class="hasAnchor">
<a href="#a-what-is-disk-frame-and-why-create-it" class="anchor"></a>a) What is <code>disk.frame</code> and why create it?</h3>
<p><code>disk.frame</code> is an R package that provides a framework for manipulating larger-than-RAM structured tabular data on disk efficiently. The reason one would want to manipulate data on disk is that it allows arbitrarily large datasets to be processed by R; hence relaxing the assumption from “R can only deal with data that fits in RAM” to be being able to “deal with data that fits on disk”. See the next section.</p>
</div>
<div id="b-how-is-it-different-to-data-frame-and-data-table" class="section level3">
<h3 class="hasAnchor">
<a href="#b-how-is-it-different-to-data-frame-and-data-table" class="anchor"></a>b) How is it different to <code>data.frame</code> and <code>data.table</code>?</h3>
<p>A <code>data.frame</code> in R is an in-memory data structure, which means that R must load the data in its entirety into RAM. A corollary of this is that only data that can fit into RAM can be processed using <code>data.frame</code>s. This places significant restrictions on what R can process with minimal hassle.</p>
<p>In contrast, <code>disk.frame</code> provides a framework to store and manipulate data on the hard drive. It does this by loading only a small part of the data, called a chunk, into RAM; process the chunk, write out the results and repeat with the next chunk. This chunking strategy is widely applied in other packages to enable processing large amounts of data in R, for example, see <a href="https://github.com/edwindj/chunked"><code>chunkded</code></a> <a href="https://github.com/ropensci/arkdb"><code>arkdb</code></a>, and <a href="https://github.com/s-u/iotools"><code>iotools</code></a>.</p>
<p>Furthermore, there is a row-limit of 2^31 for <code>data.frame</code>s in R; hence an alternate approach is needed to apply R to these large datasets. The chunking mechanism in <code>disk.frame</code> provides such an avenue to enable data manipulation beyond the 2^31 row limit.</p>
</div>
<div id="c-how-is-disk-frame-different-to-previous-big-data-solutions-for-r" class="section level3">
<h3 class="hasAnchor">
<a href="#c-how-is-disk-frame-different-to-previous-big-data-solutions-for-r" class="anchor"></a>c) How is <code>disk.frame</code> different to previous “big” data solutions for R?</h3>
<p>R has many packages that can deal with larger-than-RAM datasets, including <code>ff</code> and <code>bigmemory</code>. However, <code>ff</code> and <code>bigmemory</code> restrict the user to primitive data types such as double, which means they do not support character (string) and factor types. In contrast, <code>disk.frame</code> makes use of <code><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table::data.table</a></code> and <code>data.frame</code> directly, so all data types are supported. Also, <code>disk.frame</code> strives to provide an API that is as similar to <code>data.frame</code>’s where possible. <code>disk.frame</code> supports many <code>dplyr</code> verbs for manipulating <code>disk.frame</code>s.</p>
<p>Additionally, <code>disk.frame</code> supports parallel data operations using infrastructures provided by the excellent <a href="https://cran.r-project.org/web/packages/future/vignettes/future-1-overview.html"><code>future</code> package</a> to take advantage of multi-core CPUs. Further, <code>disk.frame</code> uses state-of-the-art data storage techniques such as fast data compression, and random access to rows and columns provided by the <a href="http://www.fstpackage.org/"><code>fst</code> package</a> to provide superior data manipulation speeds.</p>
</div>
<div id="d-how-does-disk-frame-work" class="section level3">
<h3 class="hasAnchor">
<a href="#d-how-does-disk-frame-work" class="anchor"></a>d) How does <code>disk.frame</code> work?</h3>
<p><code>disk.frame</code> works by breaking large datasets into smaller individual chunks and storing the chunks in <code>fst</code> files inside a folder. Each chunk is a <code>fst</code> file containing a <code>data.frame/data.table</code>. One can construct the original large dataset by loading all the chunks into RAM and row-bind all the chunks into one large <code>data.frame</code>. Of course, in practice this isn’t always possible; hence why we store them as smaller individual chunks.</p>
<p><code>disk.frame</code> makes it easy to manipulate the underlying chunks by implementing <code>dplyr</code> functions/verbs and other convenient functions (e.g. the <code><a href="reference/map.disk.frame.html">map.disk.frame(a.disk.frame, fn, lazy = F)</a></code> function which applies the function <code>fn</code> to each chunk of <code>a.disk.frame</code> in parallel). So that <code>disk.frame</code> can be manipulated in a similar fashion to in-memory <code>data.frame</code>s.</p>
</div>
<div id="e-how-is-disk-frame-different-from-spark-dask-and-juliadb-jl" class="section level3">
<h3 class="hasAnchor">
<a href="#e-how-is-disk-frame-different-from-spark-dask-and-juliadb-jl" class="anchor"></a>e) How is <code>disk.frame</code> different from Spark, Dask, and JuliaDB.jl?</h3>
<p>Spark is primarily a distributed system that also works on a single machine. Dask is a Python package that is most similar to <code>disk.frame</code>, and JuliaDB.jl is a Julia package. All three can distribute work over a cluster of computers. However, <code>disk.frame</code> currently cannot distribute data processes over many computers, and is, therefore, single machine focused.</p>
<p>In R, one can access Spark via <code>sparklyr</code>, but that requires a Spark cluster to be set up. On the other hand <code>disk.frame</code> requires zero-setup apart from running <code><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages("disk.frame")</a></code> or <code><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">devtools::install_github("xiaodaigh/disk.frame")</a></code>.</p>
<p>Finally, Spark can only apply functions that are implemented for Spark, whereas <code>disk.frame</code> can use any function in R including user-defined functions.</p>
</div>
</div>
</div>
<div id="example-usage" class="section level1">
<h1 class="hasAnchor">
<a href="#example-usage" class="anchor"></a>Example usage</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">#install.packages(c("fst","future","data.table"))</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(devtools)) <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(disk.frame)) devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"xiaodaigh/disk.frame"</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(disk.frame)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(data.table)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(fst)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#library(future)</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#library(future.apply)</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#library(data.table)</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">nworkers =<span class="st"> </span>parallel<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/parallel/topics/detectCores">detectCores</a></span>(<span class="dt">logical=</span>F)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(nworkers,<span class="st">" workers</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#plan(multiprocess, workers = nworkers, gc = T)</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#options(future.globals.maxSize=Inf)</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">rows_per_chunk =<span class="st"> </span><span class="fl">1e7</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co"># generate synthetic data</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">tmpdir =<span class="st"> "tmpfst"</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/delete.html">dir_delete</a></span>(tmpdir)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co"># write out nworkers chunks</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb1-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">df =<span class="st"> </span><span class="kw"><a href="reference/disk.frame.html">disk.frame</a></span>(tmpdir)</a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">sapply</a></span>(<span class="dv">1</span><span class="op">:</span>(nworkers<span class="op">*</span><span class="dv">2</span>), <span class="cf">function</span>(ii) {</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(ab &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">a =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(rows_per_chunk), <span class="dt">b =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(rows_per_chunk)) ) <span class="co">#102 seconds</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29">  <span class="kw"><a href="reference/add_chunk.html">add_chunk</a></span>(df, ab, ii)</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">  <span class="ot">NULL</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31">})</a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"Generating data took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb1-33" data-line-number="33"></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="co"># read and output the disk.frame as it to assess "sequential" read-write performance</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">df2 &lt;-<span class="st"> </span><span class="kw"><a href="reference/map.disk.frame.html">map.disk.frame</a></span>(df, <span class="op">~</span>.x, <span class="dt">outdir =</span> <span class="st">"tmpfst2"</span>, <span class="dt">lazy =</span> F, <span class="dt">overwrite =</span> T)</a>
<a class="sourceLine" id="cb1-38" data-line-number="38"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"Read and write took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb1-39" data-line-number="39"></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="co"># get first few rows</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(df)</a>
<a class="sourceLine" id="cb1-42" data-line-number="42"></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"><span class="co"># get last few rows</span></a>
<a class="sourceLine" id="cb1-44" data-line-number="44"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(df)</a>
<a class="sourceLine" id="cb1-45" data-line-number="45"></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"><span class="co"># number of rows</span></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="kw"><a href="reference/nrow.html">nrow</a></span>(df)</a>
<a class="sourceLine" id="cb1-48" data-line-number="48"></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="co"># number of columns</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="kw"><a href="reference/ncol.html">ncol</a></span>(df)</a></code></pre></div>
<div id="example-dplyr-verbs" class="section level2">
<h2 class="hasAnchor">
<a href="#example-dplyr-verbs" class="anchor"></a>Example: dplyr verbs</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">df =<span class="st"> </span><span class="kw"><a href="reference/disk.frame.html">disk.frame</a></span>(tmpdir)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">suma =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(a)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># this does a count per chunk</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span><span class="kw">collect</span>(<span class="dt">parallel =</span> T)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># need a 2nd stage to finalise summing</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">suma =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(a)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># this does a count per chunk</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="st">  </span><span class="kw">collect</span>(<span class="dt">parallel =</span> T) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">suma =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(suma)) </a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co"># filter</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(df_filtered &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="st">              </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(a <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>))</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"filtering a &lt; 0.1 took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="kw"><a href="reference/nrow.html">nrow</a></span>(df_filtered)</a>
<a class="sourceLine" id="cb2-19" data-line-number="19"></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co"># group by</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">res1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/filter">filter</a></span>(b <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">blt005 =</span> b <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="st">  </span><span class="kw">group_by</span>(blt005, <span class="dt">hard =</span> T) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># hard group_by is slower but avoid a 2nd stage aggregation</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">suma =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(a), <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="st">  </span><span class="kw">collect</span>(<span class="dt">parallel =</span> T)</a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"group by took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb2-29" data-line-number="29"></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="co"># keep only one var is faster</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb2-32" data-line-number="32">res1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="st">  </span><span class="kw"><a href="reference/keep.html">srckeep</a></span>(<span class="st">"a"</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#keeping only the column `a` from the input</span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">suma =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(a), <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="st">  </span><span class="kw">collect</span>(<span class="dt">parallel =</span> T)</a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"summarise keeping only one column "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb2-37" data-line-number="37"></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co"># same operation without keeping</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb2-40" data-line-number="40">res1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">suma =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(a), <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="st">  </span><span class="kw">collect</span>(<span class="dt">parallel =</span> T)</a>
<a class="sourceLine" id="cb2-43" data-line-number="43"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"summarise without keeping"</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a></code></pre></div>
</div>
<div id="example-data-table-syntax" class="section level2">
<h2 class="hasAnchor">
<a href="#example-data-table-syntax" class="anchor"></a>Example: data.table syntax</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># count by chunks</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(df_cnt_by_chunk &lt;-<span class="st"> </span>df[,.N])</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(df[,.N])) <span class="co"># need a 2nd stage of summary</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"sum(df[,.N]) took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"># filter</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(df_filtered &lt;-<span class="st"> </span>df[a <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>,])</a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"df[a &lt; 0.1,] took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="kw"><a href="reference/nrow.html">nrow</a></span>(df_filtered)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co"># group by</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(res1 &lt;-<span class="st"> </span>df[b <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>,.(<span class="dt">sum_a =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(a), .N), <span class="dt">by =</span> b <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>])</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"df[b &lt; 0.1,.(sum_a = sum(a), .N), by = b &lt; 0.05] took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co"># res1 has performed group by for each of the 4 chunks need to further summarise</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(res2 &lt;-<span class="st"> </span>res1[, .(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(sum_a), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(N)),b][, .(<span class="dt">mean_a =</span> V1<span class="op">/</span>V2), b])</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">res2 <span class="co"># abit painful to create mean, but currently only this low level interface; will do a dplyr on top later</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co"># keep only one var is faster</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(df[,.(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(a)), <span class="dt">keep =</span> <span class="st">"a"</span>][,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(V1)]) <span class="co"># 1.17</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"df[,.(sum(a)), keep = 'a'] took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb3-25" data-line-number="25"></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="co"># same operation without keeping</span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27">pt =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/proc.time">proc.time</a></span>()</a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(df[,.(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(a))][,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(V1)]) <span class="co">#2.95</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"df[,.(sum(a))] took: "</span>, <span class="kw">timetaken</span>(pt), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a></code></pre></div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://opensource.org/licenses/mit-license.php">MIT</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Dai ZJ <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  </div>
</div>

      <footer><div class="copyright">
  <p>Developed by Dai ZJ.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
